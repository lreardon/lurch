var allowedChildrenProblems,isGroupRight,markGroupRight,markGroupWrong,tagData,hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};tagData={},window.setTagData=function(e){return tagData=e},window.addTagData=function(e){var t,n,a;n=[];for(t in e)hasProp.call(e,t)&&(a=e[t],n.push(tagData[t]=a));return n},window.pluginsToLoad=["dialogs"],window.setGroupTag=function(e,t){return e.set("tagName",t)},window.getGroupTag=function(e){return e.get("tagName")},window.initializeGroupTag=function(e){var t,n;if(t=e.parent?window.getGroupTag(e.parent):window.topLevelTagName(),n=window.getTagData(t,"defaultChild"))return window.setGroupTag(e,n)},window.getTagData=function(e,t){var n;return e instanceof window.Group&&(e=window.getGroupTag(e)),null!=(n=tagData[e])?n[t]:void 0},window.getTagExternalName=function(e){var t;return e instanceof window.Group&&(e=window.getGroupTag(e)),null!=(t=window.getTagData(e,"externalName"))?t:e},window.topLevelTagName=function(){var e;for(e in tagData)if(hasProp.call(tagData,e)&&tagData[e].topLevel)return e},window.XMLMenuItems=function(e){var t,n,a,i,o,r,l;return o=[],null!=(r=window.getGroupTag(e))&&(a=window.getTagExternalName(r),null!=(n=window.getTagData(r,"documentation"))&&(n=n.replace(/a href=/g,'a target="_blank" href='),o.push({text:'Read "'+a+'" documentation',onclick:function(){return tinymce.activeEditor.Dialogs.alert({title:'Documentation for "'+a+'"',message:n})}}))),o.push({text:"View XML representation",onclick:function(){var t;return t=window.convertToXML(e).replace(/&/g,"&amp;").replace(/</g,"&lt;"),tinymce.activeEditor.Dialogs.alert({title:"XML Representation",width:600,message:'<html>\n    <head>\n        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">\n        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"><\/script>\n    </head>\n    <body>\n        <pre><code class=\'xml\'>'+t+"</code></pre>\n        <script>hljs.initHighlightingOnLoad();<\/script>\n    </body>\n</html>"})}}),i=e.parent?window.getGroupTag(e.parent):window.topLevelTagName(),t=window.getTagData(i,"allowedChildren"),o.push({text:"Change tag to...",menu:function(){var n,a,i,o;for(o=[],n=0,a=(i=Object.keys(tagData).sort()).length;n<a;n++)l=i[n],o.push(function(n){return{text:window.getTagExternalName(n),disabled:null!=t&&!(n in t),onclick:function(){return e.set("tagName",n)}}}(l));return o}()}),o},window.groupToolbarButtons={viewxml:{text:"XML",tooltip:"View XML representation of this document",onclick:function(){var e,t,n,a,i,o,r,l;for(r=[],a=0,o=(l=(n=tinymce.activeEditor).Groups.ids()).length;a<o;a++)if(i=l[a],!isGroupRight(n.Groups[i])){r.push("At least one element in your document has errors (indicated by a red X following the element).");break}return(e=window.getTagData(window.topLevelTagName(),"allowedChildren"))&&(r=r.concat(allowedChildrenProblems(n.Groups.topLevel,e,"document"))),t=function(){var e;return e=window.convertToXML().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),tinymce.activeEditor.Dialogs.alert({title:"XML Representation",width:800,height:600,message:'<html>\n    <head>\n        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">\n        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"><\/script>\n    </head>\n    <body>\n        <pre><code class=\'xml\'>'+e+"</code></pre>\n        <script>hljs.initHighlightingOnLoad();<\/script>\n    </body>\n</html>"})},0===r.length?t():tinymce.activeEditor.Dialogs.confirm({title:"Problems with your document",message:"<p><b>The problems listed below exist in your document.</b></p> <ul><li>"+r.join("</li><li>")+"</li></ul> <p>You can click OK to generate XML anyway, but it may be invalid.  Click Cancel to go back and fix these problems first.</b></p>",okCallback:t})}}},window.XMLGroupChanged=function(e,t){return t&&!e.get("tagName")&&setTimeout(function(){return window.initializeGroupTag(e)},0),window.validateHierarchy(e)},window.XMLGroupDeleted=function(e){var t;if(null!=e.parent){if(e.parent.children[0])return window.validateHierarchy(e.parent.children[0])}else if(null!=(t=e.plugin)?t.topLevel[0]:void 0)return window.validateHierarchy(e.plugin.topLevel[0])},markGroupRight=function(e){return e.set("valid",!0),e.clear("closeDecoration"),e.clear("closeHoverText")},markGroupWrong=function(e,t){return e.set("valid",!1),e.set("closeDecoration",'<font color="red">&#10006;</font>'),e.set("closeHoverText",t)},isGroupRight=function(e){return e.get("valid")},window.validateHierarchy=function(e){var t,n,a,i,o,r,l,g,u,d,s,c,w,h,p,m;p=[];{if(e.children){if(null==(g=window.getGroupTag(e))&&p.push("Each element must have a tag, but this one does not.  Add a tag using the context menu."),s=e.parent?window.getGroupTag(e.parent):window.topLevelTagName(),"string"==typeof(i=window.getTagData(e,"belongsIn"))&&(i=[i]),i instanceof Array&&indexOf.call(i,s)<0&&(l=window.getTagExternalName(e),w=window.getTagExternalName(s),o=function(){var e,t,a;for(a=[],e=0,t=i.length;e<t;e++)n=i[e],a.push(window.getTagExternalName(n));return a}(),w=w?w+" elements":"in an element without a tag",o=function(){var e,t,a;for(a=[],e=0,t=i.length;e<t;e++)n=i[e],a.push(window.getTagExternalName(n));return a}(),c=function(){switch(o.length){case 1:return"this kind of element: "+o[0];case 2:return"these kinds of elements: "+o.join(" and ");default:return"these kinds of elements: "+o.join(", ")}}(),p.push(l+" elements are only permitted in "+c+" (not "+w+").")),h=e.previousSibling()?window.getGroupTag(e.previousSibling()):null,a=window.getTagData(e,"belongsAfter"),"string"==typeof i&&(a=[a]),null===a&&(a=[null]),a instanceof Array&&indexOf.call(a,h)<0&&(l=window.getTagExternalName(e),w=(w=window.getTagExternalName(h))?w+" elements":"being first in their context",o=function(){var e,t,i,o;for(o=[],e=0,t=a.length;e<t;e++)n=a[e],o.push(null!=(i=window.getTagExternalName(n))?i:"none (i.e., being the first in their context)");return o}(),c=function(){switch(o.length){case 1:return"this kind of element: "+o[0];case 2:return"these kinds of elements: "+o.join(" and ");default:return"these kinds of elements: "+o.join(", ")}}(),p.push(l+" elements are only permitted to follow "+c+" (not "+w+").")),window.getTagData(e,"unique"))for(m=e;m=m.previousSibling();)if(window.getGroupTag(m)===g){p.push('Each context may contain only one "'+window.getTagExternalName(e)+'" element.  But there is already an earlier one in this context, making this one invalid.');break}return(t=window.getTagData(e,"allowedChildren"))&&(p=p.concat(allowedChildrenProblems(e.children,t))),(r=window.getTagData(e,"contentCheck"))&&(u=r(e))instanceof Array&&(p=p.concat(u)),p.length>0?markGroupWrong(e,p.join("\n")):markGroupRight(e),(d=e.nextSibling())?window.validateHierarchy(d):void 0}setTimeout(function(){return window.validateHierarchy(e)},100)}},allowedChildrenProblems=function(e,t,n){var a,i,o,r,l,g,u,d,s,c,w,h,p,m;for(null==n&&(n="element"),c=[],r={},g=0,u=e.length;g<u;g++)a=e[g],null==r[i=window.getGroupTag(a)]&&(r[i]=0),r[i]++;for(h in t)hasProp.call(t,h)&&null==r[h]&&(r[h]=0);for(h in r)hasProp.call(r,h)&&(o=r[h],t.hasOwnProperty(h)&&(s=(w=t[h])[0],d=w[1],null!=s&&null!=d&&"number"==typeof s&&"number"==typeof d&&(p=1===o?"is":"are",m=1===s?"child":"children",l=window.getTagExternalName(h),o<s&&c.push("The "+n+" requires at least "+s+" "+m+" with tag "+l+", but there "+p+" "+o+" in this "+n+"."),m=1===d?"child":"children",o>d&&c.push("The "+n+" permits at most "+d+" "+m+" with tag "+l+", but there "+p+" "+o+" in this "+n+"."))));return c},window.convertToXML=function(e){var t,n,a,i,o,r,l,g,u,d,s,c,w;return null!=e?(a=e.children,u=window.getGroupTag(e)):(a=tinymce.activeEditor.Groups.topLevel,u=window.topLevelTagName()),g=function(e){var t;return"P"===(t=e.tagName)||"DIV"===t},s=function(e){var t,n,a,i,o;if(null!=e.cloneContents&&((o=document.createElement("div")).appendChild(e.cloneContents()),console.log(o),e=o),3===(null!=e?e.nodeType:void 0))return e.textContent.replace(/\u2003/g,"  ");if("BR"===e.tagName)return"\n";for(i="",n=t=0,a=e.childNodes.length;0<=a?t<a:t>a;n=0<=a?++t:--t)n>0&&(g(e.childNodes[n-1])||g(e.childNodes[n]))&&(i+="\n"),(n<e.childNodes.length-1||"BR"!==e.childNodes[n].tagName)&&(i+=s(e.childNodes[n]));return i},w=window.getTagData(u,"includeText"),c=function(e){var t,n;return w?tagData.hasOwnProperty(w)?(n="<"+w+">"+e+"</"+w+">",(t=window.getTagData(w,"alterXML"))&&(n=t(n)),n):e:""},l=function(){var t,l;if(a.length){for(i=function(e){return"  "+e.replace(RegExp("\n","g"),"\n  ")},r=a[0].rangeBefore(),o="",/^\s*$/.test(r.toString())||(o+=c(s(r))),t=0,l=a.length;t<l;t++)n=a[t],"\n"!==o[o.length-1]&&(o+="\n"),o+=window.convertToXML(n)+"\n",r=n.rangeAfter(),/^\s*$/.test(r.toString())||(o+=c(s(r)));return"<"+u+">\n"+i(o)+"\n</"+u+">"}return d=window.getTagData(u,"rawXML")?null!=e?s(e.contentAsFragment()):tinymce.activeEditor.getContent({format:"text"}).replace(/\xA0/g,"\n"):tinymce.DOM.encode(null!=e?e.contentAsHTML():tinymce.activeEditor.getContent()),null==w&&(w=!0),"<"+u+">"+c(d)+"</"+u+">"}(),(t=window.getTagData(u,"alterXML"))&&(l=t(l,e)),l};
//# sourceMappingURL=xml-groups.js.map
