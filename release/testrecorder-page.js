var installButtonClickHandlers,testState,update,waitingForMainApplication,waitingStorage;testState={steps:[]},waitingForMainApplication=!0,waitingStorage=[],window.enterWaitingState=function(){for(var t;document.body.childNodes.length>0;)t=document.body.childNodes[0],waitingStorage.push(t),$(t).remove();return document.body.innerHTML="Waiting for main application page to load...<br> (If you reloaded this window by itself, you done wrong. Instead, close this window and reload the main application.)"},window.enterReadyState=function(){for(var t,e,n;document.body.childNodes.length>0;)$(document.body.childNodes[0]).remove();for(t=0,e=waitingStorage.length;t<e;t++)n=waitingStorage[t],document.body.appendChild(n);return installButtonClickHandlers(),update()},$(window.enterWaitingState),update=function(){var t,e,n,o,i,r,a,s,c,l,u,d,p,h,g,y;if(n="",null==testState.title&&null==testState.steps)n="(no steps recorded yet)";else for(d=$("#showComments").is(":checked"),console.log($("#showComments"),d),y=function(t,e){var o,i,r,a,s;if(d&&null!=t&&(n+="\n"+t+"\n"),null!=e){for(d&&null!=t&&(n+="\n"),s=[],o=0,i=(a=e.split("\n")).length;o<i;o++)r=a[o],s.push(n+="        "+r+"\n");return s}},i=function(t){return t.replace(/'/g,"\\'")},s=function(t){return"    "+t.replace(RegExp("\n","g"),"\n    ")},n="\nTest built with Lurch test-recording mode.\n\n",g=testState.title||"untitled test",n+="    it '"+i(g)+"', inPage ->\n",c=a=0,l=(e=testState.steps).length;a<l;c=++a){if(p=e[c],c>0&&e[c].type===e[c-1].type)o=0;else for(o=1;c+o<e.length&&e[c].type===e[c+o].type;)o++;"comment"===p.type?y(p.content):"check contents"===p.type?y("Check to be sure the editor contains the correct content.","pageExpects allContent, 'toBeSimilarHTML',\n"+s(h="'"+i(p.content)+"'")):"wrong contents"===p.type?(h="'TO BE EDITED: "+i(p.content)+"'",y("At this point the editor contains incorrect contents.  (The code below will need to be edited later to replace the incorrect expectation with a correct one.)\n \nExplanation of how the expectation below is incorrect:  "+p.explanation,"pageExpects allContent, 'toBeSimilarHTML',\n"+s(h))):"key press"===p.type?(r=function(){switch(o){case 0:return null;case 1:return"Simulate pressing a key in the editor.";default:return"Simulate pressing keys in the editor."}}(),t="'"+p.content+"'",p.shift&&(t+=", 'shift'"),p.ctrl&&(t+=", 'ctrl'"),p.alt&&(t+=", 'alt'"),y(r,"pageKey "+t)):"typing"===p.type?y("Simulate typing in the editor.","pageType '"+i(p.content)+"'"):"click"===p.type?y("Simulate a mouse click in the editor.","pageClick "+p.x+", "+p.y):"button"===p.type?y(r=function(){switch(o){case 0:return null;case 1:return"Simulate clicking a command button in the editor.";default:return"Simulate clicking command buttons in the editor."}}(),"pageCommand '"+i(p.content)+"'"):y("ERROR: Unknown step type:","'"+i(p.type)+"'\n# "+p.content)}return null!=(u=document.getElementById("testCode"))?u.textContent=n:void 0},$(update),installButtonClickHandlers=function(){return $("#setTitle").on("click",function(){var t,e;if(null!==(t=prompt("Enter new test title",null!=(e=testState.title)?e:"")))return testState.title=t,update()}),$("#addComment").on("click",function(){var t;if(null!==(t=prompt("Enter your comment here","")))return testState.steps.push({type:"comment",content:t}),update()}),$("#contentsCorrect").on("click",function(){return testState.steps.push({type:"check contents",content:window.opener.tinymce.activeEditor.getContent()}),update()}),$("#contentsIncorrect").on("click",function(){var t;if(null!==(t=prompt("Please provide an explanation of why the editor's contents are incorrect.  Include a suggestion of what they ought to be, if possible.","")))return testState.steps.push({type:"wrong contents",content:window.opener.tinymce.activeEditor.getContent(),explanation:t}),update()}),$("#seeContents").on("click",function(){var t;return""===(t=window.opener.tinymce.activeEditor.getContent())?alert("Editor is empty."):alert("The editor contents are represented in HTML format below.\n\n"+t)}),$("#emailTest").on("click",function(){var t,e,n,o,i,r;for(i=!1,e=0,n=(o=testState.steps).length;e<n;e++)if(" contents"===o[e].type.slice(-9)){i=!0;break}if(i)return"ncarter@bentley.edu",r="Lurch: recorded unit test",t=encodeURIComponent("\n \nThe following unit test was recorded on "+new Date+".\n \n(Before sending this email, feel free to add any extra information you have here.)\n \n-----------begin test code------------\n "+document.getElementById("testCode").textContent),window.location.href="mailto:ncarter@bentley.edu?subject="+r+"&body="+t;alert("You have not made any assertions yet in the test. You must at some point mark the editor contents as correct or incorrect in order for the generated code to actually contain an assertion to be tested.")}),$("#showComments").on("change",function(){return console.log("checkbox changed"),update()})},window.editorKeyPress=function(t,e,n,o){var i;return i=String.fromCharCode(t),/[a-zA-Z0-9 ]/.test(i)?testState.steps.length>0&&"typing"===testState.steps[testState.steps.length-1].type?testState.steps[testState.steps.length-1].content+=i:testState.steps.push({type:"typing",content:i}):testState.steps.push({type:"key press",content:t,shift:e,ctrl:n,alt:o}),update()},window.editorMouseClick=function(t,e){return testState.steps.push({type:"click",x:t,y:e}),update()},window.buttonClicked=function(t){return testState.steps.push({type:"button",content:t}),update()};
//# sourceMappingURL=testrecorder-page.js.map
