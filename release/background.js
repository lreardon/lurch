var BackgroundFunction,workerScript,bind=function(n,r){return function(){return n.apply(r,arguments)}},hasProp={}.hasOwnProperty,slice=[].slice;workerScript="data:text/javascript;base64,dmFyIGJ1aWxkRnVuY3Rpb24saGFzUHJvcD17fS5oYXNPd25Qcm9wZXJ0eTtidWlsZEZ1bmN0aW9uPWZ1bmN0aW9uKG4pe3ZhciB0LGE7cmV0dXJuIHQ9bi5zdWJzdHJpbmcobi5pbmRleE9mKCIoIikrMSxuLmluZGV4T2YoIikiKSksYT1uLnN1YnN0cmluZyhuLmluZGV4T2YoInsiKSsxLG4ubGFzdEluZGV4T2YoIn0iKSksbmV3IEZ1bmN0aW9uKHQsYSl9LHNlbGYud2luZG93PXNlbGYsc2VsZi5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIixmdW5jdGlvbihuKXt2YXIgdCxhLGk7aWYobi5kYXRhLmhhc093blByb3BlcnR5KCJzZXRGdW5jdGlvbiIpJiYoc2VsZi5hY3Rpb249YnVpbGRGdW5jdGlvbihuLmRhdGEuc2V0RnVuY3Rpb24pKSxuLmRhdGEuaGFzT3duUHJvcGVydHkoInJ1bk9uIikmJnNlbGYucG9zdE1lc3NhZ2UoImZ1bmN0aW9uIj09dHlwZW9mIHNlbGYuYWN0aW9uP3NlbGYuYWN0aW9uLmFwcGx5KHNlbGYsbi5kYXRhLnJ1bk9uKTp2b2lkIDApLG4uZGF0YS5oYXNPd25Qcm9wZXJ0eSgiaW5zdGFsbCIpKXtpPW4uZGF0YS5pbnN0YWxsO2ZvcihhIGluIGkpaGFzUHJvcC5jYWxsKGksYSkmJih0PWlbYV0sc2VsZlthXT1idWlsZEZ1bmN0aW9uKHQpKX1pZihuLmRhdGEuaGFzT3duUHJvcGVydHkoImltcG9ydCIpKXJldHVybiBpbXBvcnRTY3JpcHRzLmFwcGx5KG51bGwsbi5kYXRhLmltcG9ydCl9LCExKTsKLy8jIHNvdXJjZU1hcHBpbmdVUkw9d29ya2VyLmpzLm1hcAo=",window.Background={functions:{},registerFunction:function(n,r,i,t){return null==i&&(i={}),null==t&&(t=[]),window.Background.functions[n]={function:r,globals:i,scripts:t}},runningTasks:[],waitingTasks:[],addTask:function(n,r,i){var t,s,e,o,u,a,l,c,d,p,h,k,b;for(o=function(n){return n instanceof Group?n.id():JSON.stringify(n)},c={name:n,inputs:r,callback:i,id:n+","+function(){var n,i,t;for(t=[],n=0,i=r.length;n<i;n++)e=r[n],t.push(o(e));return t}()},s=t=0,a=(d=window.Background.waitingTasks).length;t<a;s=++t)if((b=d[s]).id===c.id){window.Background.waitingTasks.splice(s,1);break}for(s=u=0,l=(p=window.Background.runningTasks).length;u<l;s=++u)if((b=p[s]).id===c.id){null!=(h=b.runner)&&null!=(k=h.worker)&&"function"==typeof k.terminate&&k.terminate(),window.Background.runningTasks.splice(s,1);break}return window.Background.waitingTasks.push(c),window.Background.update()},addCodeTask:function(n,r,i,t,s){return null==t&&(t={}),null==s&&(s=[]),window.Background.registerFunction(""+n,n,t,s),window.Background.addTask(""+n,r,i)},available:{},update:function(){var n,r,i,t,s;for(n=window.Background;n.runningTasks.length<n.concurrency();){if(null==(s=n.waitingTasks.shift()))return;if(null==(t=null!=(i=n.available[s.name])?i.pop():void 0)){if(null==(r=n.functions[s.name]))continue;t=new BackgroundFunction(r.function,r.globals,r.scripts)}s.runner=t,n.runningTasks.push(s),function(r){var i;i=function(){var i,s,e;return s=n.runningTasks.indexOf(r),n.runningTasks.splice(s,1),(null!=(i=n.available)[e=r.name]?i[e]:i[e]=[]).push(t),window.Background.update()},t.call.apply(t,r.inputs).sendTo(function(n){return i(),"function"==typeof r.callback?r.callback(n):void 0}).orElse(i)}(s)}}},window.Background.concurrency=function(){var n;return Math.max(1,(null!=(n="undefined"!=typeof navigator&&null!==navigator?navigator.hardwareConcurrency:void 0)?n:1)-1)},BackgroundFunction=function(){function _Class(n,r,i){var t,s,e;if(this.function=n,this.globals=r,this.scripts=i,this.call=bind(this.call,this),this.promise={sendTo:function(n){return function(r){return n.promise.resultCallback=r,n.promise.hasOwnProperty("result")&&n.promise.resultCallback(n.promise.result),n.promise}}(this),orElse:function(n){return function(r){return n.promise.errorCallback=r,n.promise.hasOwnProperty("error")&&n.promise.errorCallback(n.promise.error),n.promise}}(this)},window.Worker){this.worker=new window.Worker(workerScript),this.worker.addEventListener("message",function(n){return function(r){var i;return n.promise.result=r.data,null!=(i=n.promise)&&"function"==typeof i.resultCallback?i.resultCallback(r.data):void 0}}(this),!1),this.worker.addEventListener("error",function(n){return function(r){var i;return n.promise.error=r,null!=(i=n.promise)&&"function"==typeof i.errorCallback?i.errorCallback(r):void 0}}(this),!1),this.worker.postMessage({setFunction:""+this.function}),e=this.globals;for(s in e)hasProp.call(e,s)&&(t=e[s],this.globals[s]=""+t);this.worker.postMessage({install:this.globals}),this.worker.postMessage({import:this.scripts})}}return _Class.prototype.call=function(){var args,i,input,inputs,len;for(args=1<=arguments.length?slice.call(arguments,0):[],delete this.promise.result,delete this.promise.resultCallback,delete this.promise.error,delete this.promise.errorCallback,i=0,len=args.length;i<len;i++)if((input=args[i])instanceof Group&&input.deleted)return;return inputs=function(){var n,r,i;for(i=[],n=0,r=args.length;n<r;n++)(input=args[n])instanceof Group?i.push(input.toJSON()):i.push(input);return i}(),null!=this.worker?this.worker.postMessage({runOn:inputs}):setTimeout(function(_this){return function(){var base,base1,e;try{with(this.globals)_this.promise.result=_this.function.apply(_this,inputs)}catch(n){return e=n,_this.promise.error=e,void("function"==typeof(base=_this.promise).errorCallback&&base.errorCallback(_this.promise.error))}return"function"==typeof(base1=_this.promise).resultCallback?base1.resultCallback(_this.promise.result):void 0}}(this),0),this.promise},_Class}();
//# sourceMappingURL=background.js.map
